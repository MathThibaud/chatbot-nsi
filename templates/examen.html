
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Examen - Chatbot NSI</title>
    <link rel="stylesheet" href="/static/css/style.css">

    <!-- CodeMirror for student responses -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.9/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.9/theme/eclipse.min.css">

    <!-- Highlight.js for syntax highlighting in Markdown -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <style>
        .exercice {
            background-color: #fff;
            padding: 1em;
            margin-bottom: 2em;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .CodeMirror {
            border: 1px solid #ccc;
            font-size: 1em;
        }

        pre code {
            background: #f5f5f5;
            padding: 0.5em;
            display: block;
            border-radius: 5px;
            font-family: "Courier New", Courier, monospace;
            overflow-x: auto;
        }

        code {
            background: #f0f0f0;
            padding: 0.1em 0.3em;
            border-radius: 4px;
            font-family: "Courier New", Courier, monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Mode Examen</h1>
        <div id="exercice1" class="exercice">
            <h2>Exercice 1</h2>
            <div id="markdown1"></div>
            <textarea id="code1"></textarea>
        </div>
        <div id="exercice2" class="exercice">
            <h2>Exercice 2</h2>
            <div id="markdown2"></div>
            <textarea id="code2"></textarea>
        </div>
        <button onclick="evaluer()">✅ Valider mon code</button>
        <pre id="resultat"></pre>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.9/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.9/mode/python/python.min.js"></script>

    <script>
        let editor1, editor2;

        function initialiserCodeMirror() {
            editor1 = CodeMirror.fromTextArea(document.getElementById("code1"), {
                lineNumbers: true,
                mode: "python",
                theme: "eclipse",
                indentUnit: 4,
                tabSize: 4,
                smartIndent: true
            });
            editor2 = CodeMirror.fromTextArea(document.getElementById("code2"), {
                lineNumbers: true,
                mode: "python",
                theme: "eclipse",
                indentUnit: 4,
                tabSize: 4,
                smartIndent: true
            });
        }

        function chargerExercice() {
            fetch("/exercice_aleatoire")
                .then(response => response.json())
                .then(data => {
                    let parties = data.contenu.split(/EXERCICE\s+2/i);
                    let exercice1 = parties[0];
                    let exercice2 = "EXERCICE 2" + (parties[1] || "");

                    document.getElementById("markdown1").innerHTML = marked.parse(exercice1);
                    document.getElementById("markdown2").innerHTML = marked.parse(exercice2);
                    hljs.highlightAll();
                    initialiserCodeMirror();
                })
                .catch(error => {
                    document.getElementById("markdown1").innerText = "❌ Erreur de chargement.";
                    document.getElementById("markdown2").innerText = "";
                });
        }

        function evaluer() {
            const code1 = editor1.getValue();
            const code2 = editor2.getValue();
            fetch("/evaluer", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({code1, code2})
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById("resultat").innerText = data.resultat;
            })
            .catch(error => {
                document.getElementById("resultat").innerText = "❌ Erreur lors de l'évaluation.";
            });
        }

        window.onload = chargerExercice;
    </script>
</body>
</html>
